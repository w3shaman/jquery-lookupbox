/**
 * jQuery script for creating lookup box
 * @version 1.2
 * @requires jQuery UI
 *
 * Copyright (c) 2016 Lucky
 * Licensed under the GPL license:
 *   http://www.gnu.org/licenses/gpl.html
 */
 
(function(b){function a(c){var d={id:"lookup-dialog-box",title:"Lookup",url:"",loadingDivId:"loading1",imgLoader:'<img src="images/ajax-loader.gif">',notFoundMessage:"Data not found!",requestErrorMessage:"Request error!",tableHeader:null,onSearch:null,searchButtonId:"lookupbox-search-button",searchTextId:"lookupbox-search-key",searchResultId:"lookupbox-search-result",width:400,htmlForm:'<form id="lookupbox-search-form" onsubmit="return false"><input id="lookupbox-search-key" type="text" name="key" placeholder="Enter search criteria." /> <input type="button" id="lookupbox-search-button" value="Search" /> <span id="loading1"></span></form><div id="lookupbox-search-result"></div>',modal:true,draggable:true,onItemSelected:null,item:null,hiddenFields:[]};b.extend(d,c);b(document).ready(function(){if(b("#"+d.id).length==0){var e=b('<div id="'+d.id+'"></div>')}else{var e=b("#"+d.id)}e=e.html(d.htmlForm).dialog({autoOpen:false,title:d.title,modal:d.modal,draggable:d.draggable,width:d.width});b("#"+d.searchButtonId).click(function(){if(d.onSearch==null){b.ajax({beforeSend:function(){b("#"+d.loadingDivId).html(d.imgLoader)},url:d.url+b("#"+d.searchTextId).val(),success:function(f){try{var l=null;if(typeof f=="string"){l=b.parseJSON(f)}else{if(typeof f=="object"){l=f}}d.item=l;var k="<table cellspacing='0' cellpadding='3' id='lookupbox-result' class='lookupbox-result'>";if(d.tableHeader!=null){k=k+"<tr id='lookupbox-result-header' class='lookupbox-result-header'>";for(var j=0;j<d.tableHeader.length;j++){k=k+"<th>"+d.tableHeader[j]+"</th>"}k=k+"</tr>"}for(j=0;j<l.length;j++){var g="lookupbox-result-row odd";if(j%2==0){g="lookupbox-result-row even"}k=k+"<tr id='lookupbox-result-row-"+j+"' class='"+g+"'>";for(var h in l[j]){if(b.inArray(h,d.hiddenFields)===-1){k=k+"<td style='cursor:pointer'>"+l[j][h]+"</td>"}}k=k+"</tr>"}k=k+"</table>";b("#"+d.searchResultId).html(k);if(d.onItemSelected!=null){b("#lookupbox-result tr").click(function(){var i=b(this).attr("id").split("-");if(typeof d.onItemSelected==="function"){d.onItemSelected.call(this,d.item[i[i.length-1]])}e.dialog("close")})}}catch(m){b("#"+d.searchResultId).html(d.notFoundMessage)}b("#"+d.loadingDivId).html("")},error:function(h,f,g){b("#"+d.searchResultId).html(d.requestErrorMessage)}})}else{if(typeof d.onSearch==="function"){d.onSearch.call()}}});b("#"+d.searchTextId).keyup(function(f){if(f.keyCode==13){b("#"+d.searchButtonId).trigger("click")}});e.dialog("open")})}b.fn.lookupbox=function(c){var d=c;return this.each(function(){b(this).click(function(){a(d)})})}})(jQuery);
