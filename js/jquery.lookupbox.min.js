/**
 * jQuery script for creating lookup box
 * @version 1.2.1
 * @requires jQuery UI
 *
 * Copyright (c) 2016 Lucky
 * Licensed under the GPL license:
 *   http://www.gnu.org/licenses/gpl.html
 */

(function(b){function a(c){var d={id:"lookup-dialog-box",title:"Lookup",url:"",loadingDivId:"loading1",imgLoader:'<img src="images/ajax-loader.gif">',notFoundMessage:"Data not found!",requestErrorMessage:"Request error!",tableHeader:null,onSearch:null,searchButtonId:"lookupbox-search-button",searchTextId:"lookupbox-search-key",searchResultId:"lookupbox-search-result",width:400,htmlForm:'<form id="lookupbox-search-form" onsubmit="return false"><input id="lookupbox-search-key" type="text" name="key" placeholder="Enter search criteria." /> <input type="button" id="lookupbox-search-button" value="Search" /> <span id="loading1"></span></form><div id="lookupbox-search-result"></div>',modal:true,draggable:true,onItemSelected:null,item:null,hiddenFields:[],colWidth:null};b.extend(d,c);b(document).ready(function(){if(b("#"+d.id).length==0){var e=b('<div id="'+d.id+'"></div>')}else{var e=b("#"+d.id)}e=e.html(d.htmlForm).dialog({autoOpen:false,title:d.title,modal:d.modal,draggable:d.draggable,width:d.width});b("#"+d.searchButtonId).click(function(){if(d.onSearch==null){b.ajax({beforeSend:function(){b("#"+d.loadingDivId).html(d.imgLoader)},url:d.url+b("#"+d.searchTextId).val(),success:function(f){try{var k=null;if(typeof f=="string"){k=b.parseJSON(f)}else{if(typeof f=="object"){k=f}}d.item=k;if(k.length>0){var j="<table cellspacing='0' cellpadding='3' id='lookupbox-result' class='lookupbox-result'>";j=j+"<tr id='lookupbox-result-header' class='lookupbox-result-header'>";i=0;for(var h in k[0]){if(b.inArray(h,d.hiddenFields)===-1){if(b.type(d.tableHeader)=="object"){idx=h}else{idx=i}colName=h;if(d.tableHeader!=null){if(typeof(d.tableHeader[idx])!="undefined"){colName=d.tableHeader[idx]}}colWidth="";if(d.colWidth!=null){if(typeof(d.colWidth[idx])!="undefined"){if(d.colWidth[idx]!=null){colWidth=" style='width: "+d.colWidth[idx]+"'"}}}j=j+"<th"+colWidth+">"+colName+"</th>";i++}}j=j+"</tr>";for(i=0;i<k.length;i++){var g="lookupbox-result-row odd";if(i%2==0){g="lookupbox-result-row even"}j=j+"<tr id='lookupbox-result-row-"+i+"' class='"+g+"'>";for(var h in k[i]){if(b.inArray(h,d.hiddenFields)===-1){j=j+"<td style='cursor:pointer'>"+k[i][h]+"</td>"}}j=j+"</tr>"}j=j+"</table>";b("#"+d.searchResultId).html(j);if(d.onItemSelected!=null){b("#lookupbox-result tr").click(function(){var m=b(this).attr("id").split("-");if(typeof d.onItemSelected==="function"){d.onItemSelected.call(this,d.item[m[m.length-1]])}e.dialog("close")})}}else{b("#"+d.searchResultId).html(d.notFoundMessage)}}catch(l){b("#"+d.searchResultId).html(d.requestErrorMessage)}b("#"+d.loadingDivId).html("")},error:function(h,f,g){b("#"+d.searchResultId).html(d.requestErrorMessage)}})}else{if(typeof d.onSearch==="function"){d.onSearch.call()}}});b("#"+d.searchTextId).keyup(function(f){if(f.keyCode==13){b("#"+d.searchButtonId).trigger("click")}});e.dialog("open")})}b.fn.lookupbox=function(c){var d=c;return this.each(function(){b(this).click(function(){a(d)})})}})(jQuery);